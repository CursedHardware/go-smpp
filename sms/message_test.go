package sms

import (
	"bytes"
	"encoding/hex"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestMarshal(t *testing.T) {
	samples := []string{
		"0001000B915121551532F400000CC8F79D9C07E54F61363B04",
		"0001010B915121551532F40010104190991D9EA341EDF27C1E3E9743",
		"0001AB0B915121551532F400C80F3190BB7C07D9DFE971B91D4EB301",
		"0011000B916407281553F80000AA0AE8329BFD4697D9EC37",
		"0041000B915121551532F40000631A0A031906200A032104100A032705040A032E05080A043807002B8ACD29A85D9ECFC3E7F21C340EBB41E3B79B1E4EBB41697A989D1EB340E2379BCC02B1C3F27399059AB7C36C3628EC2683C66FF65B5E2683E8653C1D",
		"0041000B915121551532F40000A0050003000301986F79B90D4AC3E7F53688FC66BFE5A0799A0E0AB7CB741668FC76CFCB637A995E9783C2E4343C3D4F8FD3EE33A8CC4ED359A079990C22BF41E5747DDE7E9341F4721BFE9683D2EE719A9C26D7DD74509D0E6287C56F791954A683C86FF65B5E06B5C36777181466A7E3F5B0AB4A0795DDE936284C06B5D3EE741B642FBBD3E1360B14AFA7E7",
		"0041000B915121551532F400042E0B05040B84C0020003F001010A060403B081EA02066A008509036D6F62696C65746964696E67732E636F6D2F0001",
		"0041000B915121551532F400045E0B05040B84C0020003F001010B060403AE81EA02056A0045C60C036D6F62696C65746964696E67732E636F6D2F000AC30620090226162510C3062009030416250103436865636B206F7574204D6F62696C6520546964696E677321000101",
		"07911326040000F0040B911346610089F60000208062917314080CC8F71D14969741F977FD07",
		"07915892000000F0040B915892214365F700007040213252242331493A283D0795C3F33C88FE06C9CB6132885EC6D341EDF27C1E3E97E7207B3A0C0A5241E377BB1D7693E72E",
		"07917283010010F5040BC87238880900F10000993092516195800AE8329BFD4697D9EC37",
		"07919761989901F0040B919762995696F000084160621263036178042D0442043E0442002004300431043E043D0435043D0442002004370432043E043D0438043B002004320430043C0020003200200440043004370430002E0020041F043E0441043B04350434043D043804390020002D002000200032003600200438044E043D044F00200432002000320031003A00330035",
		"07919762020033F1040B919762995696F0000041606291401561046379180E",
		"089158921000100930040ED0D376584E7DBBCB000871601002744523664F6066AB6642672A75338ACB4F8696FB8F4999C1670D52D9002E002059826B3275338ACB6B64670D52D9002C8ACB6309002A003100310031002A00320031002A00310023625351FA002E0020670D52D98CBB003A0020002400310035002E00300030002F6708",
	}
	for _, pdu := range samples {
		decoded, err := hex.DecodeString(pdu)
		require.NoError(t, err)
		parsed, err := Unmarshal(bytes.NewReader(decoded))
		require.NoError(t, err)
		var buf bytes.Buffer
		_, err = Marshal(&buf, parsed)
		require.NoError(t, err)
		require.Equal(t, decoded, buf.Bytes())
	}
}
